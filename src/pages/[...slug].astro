---
import { type CollectionEntry, getCollection } from 'astro:content';
import { render } from 'astro:content';

import MainLayout from '../layouts/MainLayout.astro';
import BaseHead from '../components/BaseHead.astro';
import FormattedDate from '../components/FormattedDate.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content } = await render(post);

const { title, description, publihsed_date, updatedDate, heroImage } = post.data;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body class="overflow-y-hidden">
    <MainLayout>
      <article class="flex flex-col gap-5">
        <div class="title flex flex-col gap-2">
          <div class="date">
            <p class="text-sm text-gray-400">
              <FormattedDate date={publihsed_date} />
            </p>

            {
              updatedDate && (
                <div class="last-updated-on">
                  Last updated on <FormattedDate date={updatedDate} />
                </div>
              )
            }
          </div>

          <h1 class="text-5xl font-semibold">{title}</h1>
        </div>

        <hr class="border-gray-300" />

        <div class="prose flex flex-col gap-5">
          <div class="hero-image">
            {heroImage && <img width={1020} height={510} src={heroImage} alt="" />}
          </div>

          <Content />
        </div>
      </article>
    </MainLayout>
  </body>
</html>
