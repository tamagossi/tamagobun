---
import { type CollectionEntry, getCollection } from 'astro:content';
import { render } from 'astro:content';

import MainLayout from '../layouts/MainLayout.astro';
import BaseHead from '../components/BaseHead.astro';
import FormattedDate from '../components/FormattedDate.astro';
import BlogDetailToC from '../components/blog-detail/BlogDetailToC.astro';
import { cn } from '../utils/cn';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content, headings } = await render(post);

const { title, description, published_date, updated_date, heroImage } = post.data;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body
    class={cn(
      'flex flex-col min-h-screen',
      'font-sans antialiased',
      'bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark transition-colors duration-200'
    )}
  >
    <MainLayout>
      <div class={cn('flex flex-col lg:flex-row flex-grow w-full max-w-7xl mx-auto')}>
        <BlogDetailToC headings={headings} />

        <main class={cn('flex-grow w-full max-w-4xl mx-auto', 'px-6 py-10 md:px-12 lg:px-16')}>
          <article class="flex flex-col w-full gap-3">
            <div class="flex flex-wrap gap-2 mb-6">
              <div
                class={cn(
                  'px-3 py-1 rounded-full text-xs font-medium',
                  'bg-gray-100 dark:bg-gray-800',
                  'text-text-secondary-light dark:text-text-secondary-dark'
                )}
              >
                Published <FormattedDate date={published_date} />
              </div>
              {
                updated_date && (
                  <div
                    class={cn(
                      'px-3 py-1 rounded-full text-xs font-medium',
                      'bg-gray-100 dark:bg-gray-800',
                      'text-text-secondary-light dark:text-text-secondary-dark'
                    )}
                  >
                    Updated <FormattedDate date={updated_date} />
                  </div>
                )
              }
            </div>

            <h1 class={cn('text-4xl md:text-5xl font-bold', 'text-primary dark:text-white')}>
              {title}
            </h1>

            <div
              class={cn(
                'prose prose-lg dark:prose-invert max-w-none',
                'prose-headings:font-bold prose-headings:tracking-tight',
                'prose-a:text-primary dark:prose-a:text-white prose-a:no-underline hover:prose-a:underline'
              )}
            >
              <div class="hero-image">
                {
                  heroImage && (
                    <img width={1020} height={510} src={heroImage} alt="" class="rounded-lg mb-8" />
                  )
                }
              </div>

              <div id="article-content">
                <Content />
              </div>
            </div>
          </article>
        </main>
      </div>
    </MainLayout>
  </body>
</html>
