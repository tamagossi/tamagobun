---
import { type CollectionEntry, getCollection } from 'astro:content';
import { render } from 'astro:content';

import MainLayout from '../layouts/MainLayout.astro';
import BaseHead from '../components/BaseHead.astro';
import FormattedDate from '../components/FormattedDate.astro';
import BlogDetailToC from '../components/blog-detail/BlogDetailToC.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: post,
  }));
}

type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content } = await render(post);

const { title, description, puiblished_date, updatedDate, heroImage } = post.data;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body class="overflow-y-hidden h-screen">
    <MainLayout>
      <div class="flex flex-col lg:grid lg:grid-cols-12 lg:gap-8 w-full max-h-full min-h-full">
        <aside class="hidden lg:block lg:col-span-4 xl:col-span-3">
          <BlogDetailToC />
        </aside>

        <main class="lg:col-span-8 xl:col-span-9 px-3 py-10 overflow-y-scroll">
          <article class="flex flex-col w-full gap-5">
            <div class="title flex flex-col gap-1">
              <div class="date">
                <p class="text-sm text-gray-400">
                  <FormattedDate date={puiblished_date} />
                </p>

                {
                  updatedDate && (
                    <div class="last-updated-on text-sm text-gray-400">
                      Last updated on <FormattedDate date={updatedDate} />
                    </div>
                  )
                }
              </div>

              <h1 class="text-2xl md:text-3xl lg:text-4xl font-semibold">{title}</h1>
            </div>

            <hr class="border-gray-300" />

            <div class="prose prose-lg max-w-none flex flex-co">
              <div class="hero-image">
                {
                  heroImage && (
                    <img width={1020} height={510} src={heroImage} alt="" class="rounded-lg" />
                  )
                }
              </div>

              <div id="article-content">
                <Content />
              </div>
            </div>
          </article>
        </main>
      </div>
    </MainLayout>
  </body>
</html>
